<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Infrastructure | HRMate+</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <style>
        :root {
            --bg: #f0f7ff;
            --surface: #ffffff;
            --border: #e2e8f0;
            --accent: #3b82f6;
            --text-main: #1e293b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text-main); overflow: hidden; }
        .glass-card { background: var(--surface); border: 1px solid var(--border); border-radius: 24px; transition: 0.3s; }
        .sidebar-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 16px; font-size: 14px; font-weight: 600; cursor: pointer; transition: 0.2s; color: #64748b; }
        .sidebar-item:hover, .sidebar-item.active { background: #eff6ff; color: var(--accent); }
        .project-stat-card { padding: 20px; border-radius: 20px; background: #f8fafc; border: 1px solid var(--border); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(240, 247, 255, 0.8); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 4000; }
        #calendar { background: white; padding: 20px; border-radius: 24px; height: 600px; }
        .fc-toolbar-title { font-size: 1.2rem !important; font-weight: 800 !important; }
        .badge-pending { background: #fef3c7; color: #92400e; }
        .btn-action { transition: 0.3s; transform-origin: center; }
        .btn-action:hover { transform: scale(1.05); }

        /* FAB & AI CHAT UI */
        #chat-fab { position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px; background: #000; border-radius: 22px; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; z-index: 3000; box-shadow: 0 20px 40px rgba(0,0,0,0.2); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #chat-fab:hover { transform: scale(1.1) translateY(-5px); background: var(--accent); }
        #chat-window { position: fixed; bottom: 110px; right: 30px; width: 400px; height: 550px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 32px; display: none; flex-direction: column; z-index: 3000; overflow: hidden; box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.25); animation: chatSlide 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @keyframes chatSlide { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
    </style>
</head>
<body>
    <div class="flex h-screen">
        <aside class="w-80 bg-white border-r border-slate-200 flex flex-col p-8 z-10">
            <div class="font-800 text-2xl mb-10 tracking-tighter text-blue-600">HRMATE<span class="text-slate-900">+</span></div>
            <nav class="flex-1 space-y-2 overflow-y-auto">
                <div class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Core Management</div>
                <div onclick="showView('dashboard')" id="nav-dashboard" class="sidebar-item active"><i data-lucide="layout-dashboard" size="18"></i> Dashboard</div>
                <div onclick="showView('calendar')" id="nav-calendar" class="sidebar-item"><i data-lucide="calendar" size="18"></i> HRMate Calendar</div>
                <div onclick="showView('meetings')" id="nav-meetings" class="sidebar-item"><i data-lucide="video" size="18"></i> Strategic Syncs</div>
                
                <div class="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-8 mb-4">Operations</div>
                <div onclick="showView('leaves')" id="nav-leaves" class="sidebar-item"><i data-lucide="calendar-check" size="18"></i> Approval Queue</div>
                <div onclick="showView('payroll')" id="nav-payroll" class="sidebar-item"><i data-lucide="banknote" size="18"></i> Payroll Console</div>
                <div onclick="openModal('employeeModal')" class="sidebar-item"><i data-lucide="user-plus" size="18"></i> Add Personnel</div>
                <div onclick="openModal('projectModal')" class="sidebar-item"><i data-lucide="plus-circle" size="18"></i> Create Project</div>
                <div onclick="openModal('meetingModal')" class="sidebar-item"><i data-lucide="video" size="18"></i> Schedule Sync</div>
                
                <div class="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-8 mb-4">Workstream Explorer</div>
                {% for project in projects %}
                <div onclick="openProjectDetails('{{ project[1] }}', '{{ project[2] }}', '{{ project[6] }}', '{{ project[3] }}', '{{ project[4] }}', '{{ project[5] }}')" class="p-4 bg-slate-50 border border-slate-100 rounded-2xl mb-3 cursor-pointer hover:border-blue-300 transition group">
                    <div class="text-xs font-bold text-slate-900 group-hover:text-blue-600">{{ project[1] }}</div>
                    <div class="text-[9px] text-slate-400 font-bold uppercase mt-1">Lead: {{ project[6] or 'Unassigned' }}</div>
                    <div class="w-full bg-slate-200 h-1 mt-2 rounded-full overflow-hidden">
                        <div class="bg-blue-500 h-full" style="width: {{ project[3] or 0 }}%"></div>
                    </div>
                </div>
                {% endfor %}
            </nav>
            <a href="/logout" class="p-4 bg-slate-900 text-white rounded-2xl text-center text-xs font-bold uppercase tracking-widest hover:bg-red-600 transition">Terminate Session</a>
        </aside>

        <main class="flex-1 overflow-y-auto p-12">
            <div id="dashboard-view">
                <header class="mb-10"><h1 class="text-3xl font-800 tracking-tight text-slate-900">Executive Hub</h1></header>
                <div class="grid grid-cols-4 gap-6 mb-10">
                    <div class="glass-card p-6 border-l-4 border-blue-500">
                        <p class="text-[10px] font-black text-slate-400 uppercase">Personnel</p>
                        <h2 class="text-2xl font-800">{{ employees|length }}</h2>
                    </div>
                    <div class="glass-card p-6 border-l-4 border-green-500">
                        <p class="text-[10px] font-black text-slate-400 uppercase">Projects</p>
                        <h2 class="text-2xl font-800">{{ projects|length }}</h2>
                    </div>
                    <div class="glass-card p-6 border-l-4 border-yellow-500">
                        <p class="text-[10px] font-black text-slate-400 uppercase">Queue</p>
                        <h2 class="text-2xl font-800">{{ leaves|length }}</h2>
                    </div>
                    <div class="glass-card p-6 border-l-4 border-purple-500">
                        <p class="text-[10px] font-black text-slate-400 uppercase">Meetings</p>
                        <h2 class="text-2xl font-800">{{ meetings|length }}</h2>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="glass-card p-8"><canvas id="deptChart" height="220"></canvas></div>
                    <div class="glass-card p-8 overflow-hidden">
                        <h3 class="text-slate-400 text-[10px] font-black uppercase tracking-widest mb-6">Personnel Node Directory</h3>
                        <div class="space-y-3 max-h-[300px] overflow-y-auto">
                            {% for emp in employees %}
                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                                <div><p class="text-sm font-bold">{{ emp[2] }}</p><p class="text-[10px] text-slate-400 uppercase">{{ emp[6] }}</p></div>
                                <button onclick="openModal('projectModal')" class="text-[10px] font-black text-blue-600 hover:underline">ASSIGN</button>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div id="leaves-view" class="hidden">
                <header class="mb-10"><h1 class="text-3xl font-800 tracking-tight text-slate-900">Leave Approval Queue</h1></header>
                <div class="glass-card overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-[10px] uppercase font-black text-slate-400">
                            <tr><th class="px-8 py-4">Employee</th><th class="px-8 py-4">Type</th><th class="px-8 py-4">Duration</th><th class="px-8 py-4">Status</th><th class="px-8 py-4 text-right">Actions</th></tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            {% for leave in leaves %}
                            <tr class="hover:bg-slate-50 transition">
                                <td class="px-8 py-5 font-bold text-sm">{{ leave[1] }}</td>
                                <td class="px-8 py-5 text-sm"><span class="px-3 py-1 bg-slate-100 rounded-full text-[10px] font-black uppercase">{{ leave[2] }}</span></td>
                                <td class="px-8 py-5 text-sm text-slate-500">{{ leave[3] }} â†’ {{ leave[4] }}</td>
                                <td class="px-8 py-5"><span class="px-3 py-1 badge-pending rounded-full text-[10px] font-black uppercase">{{ leave[5] }}</span></td>
                                <td class="px-8 py-5 text-right">
                                    <div class="flex justify-end gap-2">
                                        <a href="/update_leave/{{ leave[0] }}/Approved" class="btn-action px-4 py-2 bg-green-600 text-white rounded-xl text-[10px] font-black uppercase shadow-lg shadow-green-100">Approve</a>
                                        <a href="/update_leave/{{ leave[0] }}/Rejected" class="btn-action px-4 py-2 bg-red-600 text-white rounded-xl text-[10px] font-black uppercase shadow-lg shadow-red-100">Reject</a>
                                    </div>
                                </td>
                            </tr>
                            {% else %}
                            <tr><td colspan="5" class="px-8 py-20 text-center text-slate-400 font-bold">No pending infrastructure leave requests.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="payroll-view" class="hidden">
                <header class="mb-10"><h1 class="text-3xl font-800 tracking-tight text-slate-900">Payroll Infrastructure</h1></header>
                <div class="glass-card p-8 mb-8">
                    <h3 class="text-slate-400 text-[10px] font-black uppercase tracking-widest mb-6">Authorize Monthly Remittance</h3>
                    <form action="/process_payroll" method="POST" class="grid grid-cols-4 gap-4">
                        <select name="employee_id" class="p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none text-sm font-bold" required>
                            <option value="" disabled selected>Select Recipient</option>
                            {% for emp in employees %}<option value="{{ emp[0] }}">{{ emp[1] }}</option>{% endfor %}
                        </select>
                        <input type="number" name="salary" placeholder="Base Salary" class="p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none text-sm" required>
                        <input type="number" name="bonus" placeholder="Bonus" class="p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none text-sm">
                        <button type="submit" class="p-4 bg-slate-900 text-white font-black rounded-xl uppercase text-[10px] tracking-widest hover:bg-blue-600 transition">Authorize Payment</button>
                    </form>
                </div>
                <div class="glass-card overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-[10px] uppercase font-black text-slate-400">
                            <tr><th class="px-8 py-4">Month</th><th class="px-8 py-4">Employee</th><th class="px-8 py-4">Total Amount</th><th class="px-8 py-4">Status</th></tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            {% for entry in payroll %}
                            <tr class="hover:bg-slate-50 transition">
                                <td class="px-8 py-5 text-sm font-bold">{{ entry[0] }}</td>
                                <td class="px-8 py-5 text-sm">{{ entry[1] }}</td>
                                <td class="px-8 py-5 text-sm font-black text-blue-600">${{ entry[2] + entry[3] }}</td>
                                <td class="px-8 py-5"><span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-[10px] font-black uppercase">Disbursed</span></td>
                            </tr>
                            {% else %}
                            <tr><td colspan="4" class="px-8 py-10 text-center text-slate-400 font-bold italic">No financial records found in the current ledger.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="calendar-view" class="hidden">
                <header class="mb-10"><h1 class="text-3xl font-800 tracking-tight text-slate-900">HRMate Calendar</h1></header>
                <div id="calendar" class="glass-card"></div>
            </div>

            <div id="meetings-view" class="hidden">
                <header class="mb-10"><h1 class="text-3xl font-800 tracking-tight text-slate-900">Strategic Sync Registry</h1></header>
                <div class="glass-card overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-[10px] uppercase font-black text-slate-400">
                            <tr><th class="px-8 py-4">Briefing Topic</th><th class="px-8 py-4">Date</th><th class="px-8 py-4">Time</th><th class="px-8 py-4">Status</th></tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            {% for meeting in meetings %}
                            <tr class="hover:bg-slate-50 transition">
                                <td class="px-8 py-5 font-bold text-sm">{{ meeting[1] }}</td>
                                <td class="px-8 py-5 text-sm">{{ meeting[2] }}</td>
                                <td class="px-8 py-5 text-sm">{{ meeting[3] }}</td>
                                <td class="px-8 py-5"><span class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-[10px] font-black uppercase">{{ meeting[5] }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="project-view" class="hidden">
                <div class="flex items-center gap-4 mb-10">
                    <button onclick="showView('dashboard')" class="p-2 hover:bg-white rounded-full transition text-slate-400"><i data-lucide="arrow-left"></i></button>
                    <h1 id="det-name" class="text-3xl font-800 tracking-tight text-slate-900">Project Details</h1>
                </div>
                <div class="grid grid-cols-3 gap-8">
                    <div class="col-span-2 space-y-8">
                        <div class="glass-card p-8"><h3 class="text-slate-400 text-[10px] font-black uppercase tracking-widest mb-4">Technical Objective</h3><p id="det-desc" class="text-slate-600 leading-relaxed text-sm"></p></div>
                        <div class="grid grid-cols-2 gap-6">
                            <div class="project-stat-card"><p class="text-[10px] font-black text-slate-400 uppercase mb-2">Launch Date</p><p id="det-start" class="text-sm font-bold text-slate-900"></p></div>
                            <div class="project-stat-card"><p class="text-[10px] font-black text-slate-400 uppercase mb-2">Target Completion</p><p id="det-end" class="text-sm font-bold text-slate-900"></p></div>
                        </div>
                    </div>
                    <div class="col-span-1 space-y-8">
                        <div class="glass-card p-8 bg-blue-600 text-white border-none"><p class="text-[10px] font-black uppercase opacity-60 mb-2">Project Custodian</p><h2 id="det-lead" class="text-xl font-bold"></h2></div>
                        <div class="glass-card p-8 text-center"><p class="text-[10px] font-black uppercase text-slate-400 mb-4">Velocity Phase</p><div class="inline-flex items-center justify-center w-24 h-24 rounded-full border-4 border-blue-100 relative"><span id="det-progress" class="text-2xl font-black text-blue-600"></span></div></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div id="employeeModal" class="modal-overlay">
        <div class="modal-content glass-card p-10 w-[600px] relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeAllModals()" class="absolute top-6 right-6 text-slate-400"><i data-lucide="x"></i></button>
            <h2 class="text-2xl font-black mb-6">Register Personnel</h2>
            <form action="/add_employee" method="POST" class="grid grid-cols-2 gap-4">
                <input type="text" name="employee_id" placeholder="Employee ID" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                <input type="text" name="name" placeholder="Full Name" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                <input type="email" name="email" placeholder="Work Email" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none col-span-2" required>
                <input type="text" name="mobile_number" placeholder="Contact" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                <input type="password" name="password" placeholder="Access Password" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                <input type="text" name="department" placeholder="Department" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                <input type="text" name="role" placeholder="Role" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                <input type="date" name="date_of_joining" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none col-span-2" required>
                <button type="submit" class="col-span-2 p-4 bg-blue-600 text-white font-black rounded-xl uppercase text-xs tracking-widest mt-4">Initialize Deployment</button>
            </form>
        </div>
    </div>

    <div id="projectModal" class="modal-overlay">
        <div class="modal-content glass-card p-10 w-[500px] relative">
            <button onclick="closeAllModals()" class="absolute top-6 right-6 text-slate-400"><i data-lucide="x"></i></button>
            <h2 class="text-2xl font-black mb-6">Initialize Workstream</h2>
            <form action="/create_project" method="POST" class="space-y-4">
                <input type="text" name="name" placeholder="Project Identity" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                <textarea name="description" placeholder="Project Description" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none h-24" required></textarea>
                <div class="grid grid-cols-2 gap-4">
                    <input type="date" name="start_date" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                    <input type="date" name="end_date" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                </div>
                <input type="text" name="progress" placeholder="Initial Progress %" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" value="0">
                <select name="assigned_employees" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                    <option value="" disabled selected>Select Lead Employee Node</option>
                    {% for emp in employees %}<option value="{{ emp[1] }}">{{ emp[2] }} ({{ emp[1] }})</option>{% endfor %}
                </select>
                <button type="submit" class="w-full p-4 bg-slate-900 text-white font-black rounded-xl uppercase text-xs tracking-widest mt-4">Authorize Project</button>
            </form>
        </div>
    </div>

    <div id="meetingModal" class="modal-overlay">
        <div class="modal-content glass-card p-10 w-[500px] relative">
            <button onclick="closeAllModals()" class="absolute top-6 right-6 text-slate-400"><i data-lucide="x"></i></button>
            <h2 class="text-2xl font-black mb-6">Authorize Strategic Sync</h2>
            <form action="/schedule_meeting" method="POST" class="space-y-4">
                <input type="text" name="title" placeholder="Meeting Objective" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                <div class="grid grid-cols-2 gap-4">
                    <input type="date" name="date" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                    <input type="time" name="time" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                </div>
                <input type="text" name="participants" placeholder="Participants (Emails separated by commas)" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none" required>
                <select name="status" class="w-full p-4 rounded-xl border border-slate-100 bg-slate-50 outline-none">
                    <option value="Scheduled">Scheduled</option>
                    <option value="Urgent">Urgent</option>
                </select>
                <button type="submit" class="w-full p-4 bg-blue-600 text-white font-black rounded-xl uppercase text-xs tracking-widest mt-4">Broadcast Invitation</button>
            </form>
        </div>
    </div>

    <div id="chat-fab" onclick="toggleChat()"><i data-lucide="bot"></i></div>
    <div id="chat-window">
        <div class="bg-black p-6 text-white flex justify-between items-center"><span class="font-black text-xs uppercase tracking-widest">HRMATE+ Neural Link</span><button onclick="toggleChat()"><i data-lucide="x" size="18"></i></button></div>
        <div id="chatBody" class="flex-1 p-6 overflow-y-auto space-y-4 bg-slate-50/50"></div>
        <div class="p-4 bg-white flex gap-2 border-t border-gray-100"><input id="chatInput" type="text" class="flex-1 outline-none text-sm" placeholder="Query the system..."><button onclick="sendMessage()"><i data-lucide="send" class="text-blue-600"></i></button></div>
    </div>

    <script>
        lucide.createIcons();
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeAllModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); }
        function toggleChat() { const w = document.getElementById('chat-window'); w.style.display = w.style.display === 'flex' ? 'none' : 'flex'; }

        function showView(view) {
            const views = ['dashboard', 'calendar', 'meetings', 'project', 'leaves', 'payroll'];
            views.forEach(v => {
                const el = document.getElementById(v + '-view');
                if (el) el.classList.toggle('hidden', v !== view);
            });
            
            document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
            const navItem = document.getElementById('nav-' + view);
            if (navItem) navItem.classList.add('active');
            
            if (view === 'calendar') setTimeout(() => calendar.render(), 100);
        }

        function openProjectDetails(name, desc, lead, progress, start, end) {
            document.getElementById('det-name').innerText = name;
            document.getElementById('det-desc').innerText = desc;
            document.getElementById('det-lead').innerText = lead || 'Unassigned';
            document.getElementById('det-progress').innerText = (progress || 0) + '%';
            document.getElementById('det-start').innerText = start || '---';
            document.getElementById('det-end').innerText = end || '---';
            showView('project');
        }

        const calendarEl = document.getElementById('calendar');
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek' },
            events: '/get_meetings_json',
            eventColor: '#3b82f6'
        });

        async function loadStats() {
            const res = await fetch('/get_stats_json');
            const data = await res.json();
            new Chart(document.getElementById('deptChart'), {
                type: 'doughnut',
                data: { labels: data.labels, datasets: [{ data: data.values, backgroundColor: ['#3b82f6', '#60a5fa', '#93c5fd', '#bfdbfe'], borderWidth: 4, borderColor: '#ffffff' }] },
                options: { cutout: '80%', plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, font: { weight: '700' } } } } }
            });
        }
        loadStats();

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const body = document.getElementById('chatBody');
            if (!input.value.trim()) return;
            body.innerHTML += `<div class="p-4 bg-blue-600 text-white rounded-3xl rounded-tr-none self-end ml-auto text-[13px] font-medium max-w-[85%] shadow-lg shadow-blue-100">${input.value}</div>`;
            const userMsg = input.value; input.value = '';
            const res = await fetch('/chat', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ message: userMsg }) });
            const data = await res.json();
            body.innerHTML += `<div class="p-4 bg-white border border-gray-100 rounded-3xl rounded-tl-none self-start text-[13px] font-medium max-w-[85%] shadow-sm text-gray-700">${data.response}</div>`;
            body.scrollTop = body.scrollHeight;
        }
        document.getElementById('chatInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
    </script>
</body>
</html>